<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Food Order UI</title>

<style>
body{
  margin:0;
  font-family:Poppins, Arial;
  background:#f6f0e8;
}
.container{
  display:flex;
  gap:18px;
}
.left{
  width:70%;
  padding:20px;
}
.banner{
  padding:20px;
  background:#ff6a00;
  color:white;
  margin-bottom:20px;
}
.tabs{
  display:flex;
  gap:10px;
  margin-bottom:15px;
}
.tabs button{
  border:none;
  padding:10px 18px;
  background:white;
  border-radius:20px;
  cursor:pointer;
}
.tabs .active{
  background:#ff6a00;
  color:white;
}
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap:15px;
}
.card{
  background:white;
  padding:12px;
  text-align:center;
  transition:.2s;
}
.card:hover{
  transform:scale(1.05);
}
.card button{
  width:100%;
  padding:8px;
  background:#ff6a00;
  color:white;
  border:none;
  margin-top:8px;
  cursor:pointer;
}
aside{
  width:30%;
  background:white;
  padding:20px;
  border-left:2px solid #ddd;
  height:100vh;
  position:sticky;
  top:0;
}
.cart-item{
  background:#f3f3f3;
  padding:10px;
  margin-bottom:10px;
}
.checkout{
  width:100%;
  padding:12px;
  background:#ff6a00;
  color:white;
  border:none;
  margin-top:10px;
  cursor:pointer;
}
.clear{
  width:100%;
  padding:12px;
  background:#444;
  color:white;
  border:none;
  margin-top:10px;
  cursor:pointer;
}
@media (max-width: 820px){
  .container{ flex-direction:column; }
  .left{ width:100%; }
  aside{ width:100%; position:relative; height:auto; border-left:none; border-top:1px solid #eee; }
  .grid{ grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
  .card img{ height:130px }
}
@media (max-width:480px){
  .grid{ gap:10px }
  .card img{ height:110px }
  .tabs{ overflow:auto; }
  .tabs button{ padding:10px 12px }
  .banner{ padding:14px }
}
</style>
</head>

<body>

<div class="container">

<div style="display:none; padding:12px; background:transparent;" id="mobile-cart-toggle-wrap">
  <button id="mobileCartBtn" style="width:100%; padding:12px; background:#ff6a00; color:#fff; border:none; border-radius:8px;">Show Cart</button>
</div>

<div class="left">

<div class="banner">
  <span style="font-size:24px;font-weight:600;">Today Special</span>
  <p>Gujarati • Punjabi • Snacks</p>
</div>

<div class="tabs">
  <button class="active" onclick="filterFood('gujarati', this)">Gujarati</button>
  <button onclick="filterFood('punjabi', this)">Punjabi</button>
  <button onclick="filterFood('snacks', this)">Snacks</button>
</div>

<div id="food-list" class="grid"></div>

</div>

<aside>
  <h2>My Order</h2>
  <hr>
  <div id="cart-items"></div>
  <p>Subtotal: ₹<span id="subtotal">0</span></p>
  <p>Delivery: ₹<span id="delivery">20</span></p>
  <h3>Total: ₹<span id="total">0</span></h3>
  <button class="checkout" onclick="goToCart()">Checkout</button>
  <button class="clear" onclick="clearCart()">Clear Cart</button>
</aside>

</div>

<script>
// जब आप अपने बैकएंड को ऑनलाइन डिप्लॉय कर दें, तो नीचे दिए गए URL को अपने डिप्लॉय किए गए बैकएंड के URL से बदलें।
// उदाहरण: const BACKEND_URL = 'https://your-backend-url.onrender.com/api/foods/';
const BACKEND_URL = 'http://localhost:8000/api/foods/'; // लोकल टेस्टिंग के लिए इसे ऐसे ही रहने दें।

let foodData = [
  { id:1, name:"Sev Tameta", price:90, category:"gujarati", img:"./assets/sev.png" },
  { id:2, name:"Bhindi Fry", price:80, category:"gujarati", img:"./assets/bhindi.jpg" },
  { id:3, name:"Rotla & Chaas", price:70, category:"gujarati", img:"./assets/rotla.jpg" },
  { id:4, name:"Kadhi Khichdi", price:100, category:"gujarati", img:"./assets/kadikhichdi.jpg" },
  { id:5, name:"Undhiyu", price:160, category:"gujarati", img:"./assets/undhiu.jpg" },
  { id:6, name:"Fafda Jalebi", price:130, category:"gujarati", img:"./assets/fafda.jpg" },
  { id:7, name:"Handvo", price:90, category:"gujarati", img:"./assets/handvo.jpg" },
  { id:8, name:"Thepla", price:50, category:"gujarati", img:"./assets/thepla.jpg" },

  { id:9, name:"Chole Bhature", price:120, category:"punjabi", img:"./assets/chole.jpg" },
  { id:10, name:"Paneer Butter Masala", price:180, category:"punjabi", img:"./assets/paneer.jpg" },
  { id:11, name:"Dal Makhani", price:150, category:"punjabi", img:"./assets/Dal.jpg" },
  { id:12, name:"Tandoori Roti", price:20, category:"punjabi", img:"./assets/tandoori.jpg" },
  { id:13, name:"Amritsari Kulcha", price:140, category:"punjabi", img:"./assets/kulcha.jpg" },
  { id:14, name:"Chaap Tikka", price:170, category:"punjabi", img:"./assets/Chapp.jpg" },
  { id:15, name:"Sweet Lassi", price:60, category:"punjabi", img:"./assets/Lassi.jpg" },

  { id:16, name:"Pizza", price:180, category:"snacks", img:"./assets/Pizza.jpg" },
  { id:17, name:"Burger", price:90, category:"snacks", img:"./assets/Burger.jpg" },
  { id:18, name:"French Fries", price:100, category:"snacks", img:"./assets/fry.jpg" },
  { id:19, name:"Cold Coffee", price:80, category:"snacks", img:"./assets/Cold.jpg" },
  { id:20, name:"Spring Rolls", price:110, category:"snacks", img:"./assets/roll.jpg" },
  { id:21, name:"Sandwich", price:90, category:"snacks", img:"./assets/san.jpg" },
  { id:22, name:"Pasta", price:160, category:"snacks", img:"./assets/pasta.jpg" },
  { id:23, name:"Garlic Bread", price:120, category:"snacks", img:"./assets/garlik.jpg" }
];

const foodList = document.getElementById("food-list");
const cartItems = document.getElementById("cart-items");
let cart = {};

function renderFood(list){
  foodList.innerHTML = "";
  list.forEach(item=>{
    foodList.innerHTML += `
      <div class="card">
        <img src="${item.img}" alt="${item.name}" style="width:100%; height:150px; object-fit:cover; border-radius:5px;">
        <h3>${item.name}</h3>
        <p>₹${item.price}</p>
        <button onclick="addToCart(${item.id})">Add</button>
      </div>
    `;
  });
}

function filterFood(type, btn){
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
  if(btn) btn.classList.add("active");
  renderFood(foodData.filter(item => item.category === type));
}

function addToCart(id){
  if(!cart[id]) cart[id] = { ...foodData.find(i => i.id === id), qty: 0 };
  cart[id].qty++;
  renderCart();
}

function renderCart(){
  cartItems.innerHTML = "";
  let subtotal = 0;

  Object.values(cart).forEach(item=>{
    subtotal += item.price * item.qty;
    cartItems.innerHTML += `
      <div class="cart-item">
        <strong>${item.name}</strong><br>
        Qty: ${item.qty} — ₹${item.price * item.qty}
      </div>
    `;
  });

  document.getElementById("subtotal").innerText = subtotal;
  document.getElementById("total").innerText = subtotal + 20;
}

function clearCart(){
  cart = {};
  renderCart();
}

function goToCart(){
  localStorage.setItem("cart", JSON.stringify(Object.values(cart)));
  window.location.href = "cart.html";
}

async function loadFoodsFromBackend(){
  try{
    const res = await fetch(BACKEND_URL, { mode: 'cors' });
    if(!res.ok) throw new Error('Network response not ok');
    const data = await res.json();
    if(Array.isArray(data) && data.length){
      foodData = data.map((it, idx)=>({
        id: it.id ?? (1000+idx),
        name: it.name ?? it.title ?? 'Item',
        price: Number(it.price) || 0,
        category: it.category || 'snacks',
        img: it.image || it.img || './assets/Pizza.jpg'
      }));
      console.log('Loaded menu from backend, count=', foodData.length);
    } else {
      console.log('Backend returned no items, using local data');
    }
  }catch(err){
    console.log('Could not load backend menu, using local data', err);
  }
}

async function init(){
  await loadFoodsFromBackend();
  filterFood("gujarati", document.querySelector(".tabs button"));
  setupMobileCartToggle();
}

init();

function setupMobileCartToggle(){
  const wrap = document.getElementById('mobile-cart-toggle-wrap');
  const btn = document.getElementById('mobileCartBtn');
  const asideEl = document.querySelector('aside');
  function update(){
    if(window.innerWidth <= 820){
      wrap.style.display = 'block';
      asideEl.style.display = 'none';
    } else {
      wrap.style.display = 'none';
      asideEl.style.display = '';
    }
  }
  window.addEventListener('resize', update);
  update();
  btn.addEventListener('click', ()=>{
    if(asideEl.style.display === 'none') asideEl.style.display = 'block';
    else asideEl.style.display = 'none';
    btn.innerText = asideEl.style.display === 'none' ? 'Show Cart' : 'Hide Cart';
  });
}
setupMobileCartToggle();
</script>

</body>
</html>
